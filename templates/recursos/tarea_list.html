{% extends "base.html" %}
{% block title %}Maestro Tareas · {{ lote.nombre }}{% endblock %}

{% block content %}
<main class="shell">
    {% include "recursos/includes/lote_nav_tabs.html" %}
    <header>
        <div>
            <h1>Maestro Tareas ({{ lote.nombre }})</h1>
            <p>Tareas de obra con rubro y subrubro. Cada tarea se compone de materiales, mano de obra, subcontratos y mezclas.</p>
            <a class="link link-back" href="{% url 'recursos:lote_detalle' lote.pk %}">← Volver al lote</a>
        </div>
        <a href="{% url 'recursos:tarea_create' lote.pk %}" class="btn btn-primary">+ Nueva tarea</a>
    </header>

    <section class="card">
        {% if tareas %}
        <table>
            <thead>
            <tr>
                <th>#</th>
                <th>Rubro</th>
                <th>Subrubro</th>
                <th>Tarea</th>
                <th class="num">Precio total</th>
                {% if lote.tipo_dolar and lote.fecha_dolar %}<th class="num">Total USD</th>{% endif %}
                <th></th>
            </tr>
            </thead>
            <tbody>
            {% for tarea in tareas %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ tarea.rubro }}</td>
                <td>{{ tarea.subrubro }}</td>
                <td><a href="{% url 'recursos:tarea_detalle' lote.pk tarea.pk %}">{{ tarea.nombre }}</a></td>
                <td class="num">{{ tarea.precio_total|floatformat:2 }}</td>
                {% if lote.tipo_dolar and lote.fecha_dolar %}
                <td class="num">{% if tarea.precio_total_usd is not None %}{{ tarea.precio_total_usd|floatformat:2 }}{% else %}-{% endif %}</td>
                {% endif %}
                <td>
                    <a href="{% url 'recursos:tarea_detalle' lote.pk tarea.pk %}">Ver</a> |
                    <a href="{% url 'recursos:tarea_edit' lote.pk tarea.pk %}">Editar</a> |
                    <form action="{% url 'recursos:tarea_delete' lote.pk tarea.pk %}" method="post" style="display:inline">
                        {% csrf_token %}
                        <button type="submit" class="btn-link btn-danger" onclick="return confirm('¿Eliminar esta tarea?');">Eliminar</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p style="font-size:0.9rem; color:var(--text-muted);">No hay tareas en este lote. Creá una para empezar.</p>
        {% endif %}
    </section>
</main>
{% endblock %}
