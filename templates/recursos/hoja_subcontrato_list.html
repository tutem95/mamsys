{% extends "base.html" %}
{% block title %}Hojas de precios subcontratos · Presupuesto{% endblock %}

{% block content %}
<main class="shell">
    <header>
        <div>
            <h1>Hojas de precios subcontratos</h1>
            <p>Crea "hojas" de precios para congelar el valor de los subcontratos en una fecha determinada.</p>
        </div>
        <a class="link link-back" href="{% url 'recursos:subcontrato_list' %}">← Volver a subcontratos</a>
    </header>

    <section class="layout">
        <section class="card">
            <h2>Nueva hoja</h2>
            <form method="post">
                {% csrf_token %}
                <div class="field">
                    <label>Nombre de la hoja</label>
                    <input type="text" name="nombre" placeholder="Ej: 01/01/2025">
                </div>
                <div class="field" style="margin-top:16px;">
                    <strong style="color:var(--title);">Origen de datos:</strong><br>
                    <label style="display:flex; align-items:center; gap:8px; margin-top:8px; font-weight:400;">
                        <input type="radio" name="origen_tipo" value="actual" checked>
                        Copiar de precios actuales (tabla Subcontrato)
                    </label>
                    <label style="display:flex; align-items:center; gap:8px; margin-top:8px; font-weight:400;">
                        <input type="radio" name="origen_tipo" value="hoja">
                        Copiar de hoja existente:
                    </label>
                    <select name="origen_hoja" style="margin-top:4px;">
                        <option value="">-- Elegir hoja --</option>
                        {% for h in hojas %}
                            <option value="{{ h.pk }}">{{ h.nombre }}</option>
                        {% endfor %}
                    </select>
                </div>
                <button type="submit" class="btn btn-primary" style="margin-top:12px;">Crear hoja</button>
            </form>
        </section>

        <section class="card">
            <h2>Listado de hojas</h2>
            {% if hojas %}
                <table>
                    <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Creada</th>
                        <th>Origen</th>
                        <th></th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for hoja in hojas %}
                        <tr>
                            <td>{{ hoja.nombre }}</td>
                            <td>{{ hoja.creado_en }}</td>
                            <td>{% if hoja.origen %}{{ hoja.origen.nombre }}{% else %}Precios actuales{% endif %}</td>
                            <td>
                                <a href="{% url 'recursos:hoja_subcontrato_detalle' hoja.pk %}">Ver detalle</a>
                                |
                                <a href="{% url 'recursos:subcontrato_list' %}?hoja={{ hoja.pk }}">Ver hoja</a>
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p style="font-size:0.9rem; color:var(--text-muted);">Todavía no hay hojas de precios de subcontratos.</p>
            {% endif %}
        </section>
    </section>
</main>
{% endblock %}
